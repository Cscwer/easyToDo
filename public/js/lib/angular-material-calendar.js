angular.module("materialCalendar",["ngMaterial"]).service("Calendar",[function(){function t(t,a){var e=this,n=new Date;this.year=n.getFullYear(),this.month=n.getMonth(),this.dates=[],this.getNumDays=function(){return new Date(this.start.getYear(),this.start.getMonth()+1,0).getDate()},this.getFirstDayOfCalendar=function(t){var a=new Date(t||e.start);return a.setDate(1-a.getDay()),a},this.next=function(){this.init(this.year,this.month+2)},this.prev=function(){this.month?this.init(this.year,this.month):this.init(this.year-1,12)},this.init=function(t,a){t&&a&&(this.year=t,this.month=a-1),this.start=new Date(this.year,this.month,1,0,0),this.dates=[],this.weeks=[[]],this.year=this.start.getFullYear(),this.month=this.start.getMonth();for(var e=0,n=this.getFirstDayOfCalendar(),l=1==n.getDate()&&28==this.getNumDays()?28:35,i=-6e4*n.getTimezoneOffset(),d=0;l>d;d++){var r=864e5*d+i,s=new Date(n.valueOf()+r);!s.getDay()&&this.weeks[0].length&&(e++,this.weeks.push([])),this.dates.push(s),this.weeks[e].push(s)}return this.dates},this.init(t,a)}return t}]).directive("mdCalendar",["Calendar",function(t){return{restrict:"E",replace:!0,template:'<section layout=column layout-fill=layout-fill flex=flex class=md-calendar><md-toolbar md-swipe-right=prev() md-swipe-left=next()><div layout=column class=md-toolbar-tools><md-button ng-click=prev() class=md-calendar-left-btn>&laquo;</md-button><h2 flex=flex class=md-calendar-title>{{ calendar.start | date:titleFormat }}</h2><md-button ng-click=next() class=md-calendar-right-btn>&raquo;</md-button></div></md-toolbar><md-subheader class="md-primary no-side-padding"><div layout=row layout-fill=layout-fill class=md-subheader-content><div flex=flex ng-repeat="day in calendar.weeks[0]" class=md-calendar-subheader>{{ day | date:dayOfWeekFormat }}</div></div></md-subheader><md-content flex=flex layout=column layout-fill=layout-fill><div flex=flex layout=row layout-fill=layout-fill ng-repeat="week in calendar.weeks" class=md-calendar-month><div flex=flex layout=column layout-fill=layout-fill layout-align="center center" ng-repeat="day in week" class=md-calendar-week><div ng-click=handleDayClick(day) flex=flex layout=layout layout-fill=layout-fill data-year="{{ day | date:\'yyyy\' }}" data-month="{{ day | date:\'M\' }}" data-day="{{ day | date:\'d\' }}" class=md-calendar-day><div class=md-calendar-number>{{ day | date:dayFormat }}</div><div flex=flex class=md-calendar-content></div></div></div></div></md-content></section>',link:function(a,e,n){var l=parseInt(e.data("month")||(new Date).getMonth()+1),i=parseInt(e.data("year")||(new Date).getFullYear());a.titleFormat=e.data("title-format")||"MMMM yyyy",a.dayOfWeekFormat=e.data("day-of-week-format")||"EEEE",a.dayFormat=e.data("day-format")||"d",a.calendar=new t(i,l),a.next=function(){a.calendar.next();var t={year:a.calendar.year,month:a.calendar.month};a.$emit("md-calendar.month.next",t),a.$emit("md-calendar.month.change",t)},a.prev=function(){a.calendar.prev();var t={year:a.calendar.year,month:a.calendar.month};a.emit("md-calendar.month.prev",t),a.emit("md-calendar.month.change",t)},a.handleDayClick=function(t){a.$emit("md-calendar.date.click",t);var e=n.ngClickDate||!1;e&&"function"==typeof a[e]&&a[e](t)}}}}]);